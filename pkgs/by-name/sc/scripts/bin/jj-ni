#!/usr/bin/env bash

jj op log --limit 1
echo

from=$1
if [ -z "$from" ]; then
  from="immutable_heads()"
fi

to=$2
if [ -z "$to" ]; then
  to="@-"
fi

night=$(date +%s --date=19:00:00)
new=$((RANDOM % 7200 + 120 + night - 86400))

while read -r rev; do
  JJ_TIMESTAMP="$(date -Iseconds --date=@"$new")" jj describe --reset-author --no-edit "$rev"
  new="$((RANDOM % 600 + 120 + new))"
done < <(jj log --no-graph --reversed --template 'change_id ++ "\n"' --revisions "${from}..${to}")

echo
jj log --revisions "${from}-..${to}"
